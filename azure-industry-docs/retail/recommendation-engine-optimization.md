---
title: Optimización del motor de recomendaciones
author: kbaroni
ms.author: kbaroni
ms.date: 07/18/2018
ms.topic: article
ms.service: industry
description: Reutilización y optimización de aplicaciones de recomendaciones escritas con el lenguaje R. Basa Machine Learning Server en una máquina virtual de Azure.
ms.openlocfilehash: bce6d7df548e7bd80d73495dc0bec642817d8641
ms.sourcegitcommit: 76f2862adbec59311b5888e043a120f89dc862af
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/03/2018
ms.locfileid: "51654262"
---
# <a name="optimize-and-reuse-an-existing-recommendation-system"></a><span data-ttu-id="25681-104">Optimización y reutilización de un sistema de recomendaciones existente</span><span class="sxs-lookup"><span data-stu-id="25681-104">Optimize and reuse an existing recommendation system</span></span>  

<span data-ttu-id="25681-105">En este documento se describe el proceso de reutilizar y mejorar correctamente un sistema de recomendaciones existente escrito en R. La clave de esto era el paralelismo de las bibliotecas MicrosoftML y RevoScaleR integradas en Microsoft Machine Learning Server.</span><span class="sxs-lookup"><span data-stu-id="25681-105">This document describes the process of successfully reusing and improving an existing recommendation system written in R. The key to this was the parallelism of the MicrosoftML and RevoScaleR libraries built into Microsoft Machine Learning Server.</span></span>

## <a name="recommendation-systems-and-r"></a><span data-ttu-id="25681-106">Sistemas de recomendaciones y R</span><span class="sxs-lookup"><span data-stu-id="25681-106">Recommendation systems and R</span></span>

<span data-ttu-id="25681-107">Para un comerciante minorista, entender las preferencias del consumidor y el historial de compras es una ventaja competitiva.</span><span class="sxs-lookup"><span data-stu-id="25681-107">For a retailer, understanding consumer preferences and purchasing history is a competitive advantage.</span></span> <span data-ttu-id="25681-108">Los minoristas han usado dichos datos durante años, en combinación con el aprendizaje automático, para identificar los productos pertinentes para el consumidor y brindar una experiencia de compra personalizada.</span><span class="sxs-lookup"><span data-stu-id="25681-108">Retailers have been using such data for years, in combination with machine learning, to identify products relevant to the consumer and deliver a personalized shopping experience.</span></span> <span data-ttu-id="25681-109">El enfoque se denomina **recomendación de productos** y genera un flujo de ingresos importante para los minoristas.</span><span class="sxs-lookup"><span data-stu-id="25681-109">The approach is called **product recommendation** and it generates a significant revenue stream for retailers.</span></span> <span data-ttu-id="25681-110">Los sistemas de recomendaciones ayudan a responder preguntas tales como: *¿Qué película será la próxima que vea esta persona? ¿En qué servicios adicionales es probable que esté interesado este cliente? ¿Adónde le gustaría ir a este cliente en vacaciones?*</span><span class="sxs-lookup"><span data-stu-id="25681-110">Recommendation systems help answer questions like: *What movie will this person watch next? What additional services is this customer likely to be interested in? Where will this customer want to vacation?*</span></span>
<span data-ttu-id="25681-111">Recientemente, un cliente quería saber lo siguiente: *¿Los consumidores (suscriptores) renovarán sus contratos?*</span><span class="sxs-lookup"><span data-stu-id="25681-111">A recent customer wanted to know: *Will consumers (subscribers) renew their contracts?*</span></span> <span data-ttu-id="25681-112">El cliente tenía un modelo de recomendación existente que podría prever la probabilidad de que un suscriptor renovara un contrato.</span><span class="sxs-lookup"><span data-stu-id="25681-112">The customer had an existing recommendation model that would forecast the probability of a subscriber renewing a contract.</span></span> <span data-ttu-id="25681-113">Una vez que se generaba la previsión, se aplicaba un procesamiento adicional para clasificar una respuesta en sí, no o quizás.</span><span class="sxs-lookup"><span data-stu-id="25681-113">Once the forecast was generated, additional processing was applied to classify a response into a yes, no, or maybe.</span></span> <span data-ttu-id="25681-114">Luego, la respuesta del modelo se integraba en un proceso de negocio de un centro de llamadas.</span><span class="sxs-lookup"><span data-stu-id="25681-114">The model response was then integrated into a call center business process.</span></span> <span data-ttu-id="25681-115">Ese proceso habilitada un agente de servicio para entregar una recomendación personalizada al consumidor.</span><span class="sxs-lookup"><span data-stu-id="25681-115">That process enabled a service agent to deliver a personalized recommendation to the consumer.</span></span>  
<span data-ttu-id="25681-116">Muchos de los primeros productos de análisis de este cliente se crearon en el [lenguaje de programación R](https://docs.microsoft.com/machine-learning-server/rebranding-microsoft-r-server), incluido el modelo de Machine Learning en el centro del sistema de recomendaciones.</span><span class="sxs-lookup"><span data-stu-id="25681-116">Many of this customer’s early analytic products were built in the [programming language R](https://docs.microsoft.com/machine-learning-server/rebranding-microsoft-r-server), including the machine learning model at the core of their recommendation system.</span></span> <span data-ttu-id="25681-117">A medida que ha crecido su base de suscriptores, también lo han hecho los requisitos de datos y proceso.</span><span class="sxs-lookup"><span data-stu-id="25681-117">As their subscriber base has grown, so have the data and compute requirements.</span></span> <span data-ttu-id="25681-118">Tanto es así que la carga de trabajo de recomendaciones ahora resulta tremendamente lenta y engorrosa de procesar.</span><span class="sxs-lookup"><span data-stu-id="25681-118">So much so, the recommendation workload is now painfully slow and cumbersome to process.</span></span> <span data-ttu-id="25681-119">Ahora, Python forma cada vez más parte de su estrategia de productos de análisis.</span><span class="sxs-lookup"><span data-stu-id="25681-119">Now Python is increasingly a part of their analytic product strategy.</span></span> <span data-ttu-id="25681-120">Pero, en el corto plazo, necesitan conservar su inversión en R y encontrar un proceso de desarrollo e implementación más eficaz.</span><span class="sxs-lookup"><span data-stu-id="25681-120">But for the near term, they need to preserve their R investment and find a more efficient development and deployment process.</span></span> <span data-ttu-id="25681-121">El desafío era optimizar el enfoque existente mediante las funcionalidades de Azure.</span><span class="sxs-lookup"><span data-stu-id="25681-121">The challenge was to optimize the existing approach using capabilities in Azure.</span></span> <span data-ttu-id="25681-122">Nos embarcamos entonces en una tarea para brindar y validar una pila de tecnología de prueba de concepto para la carga de trabajo de recomendaciones.</span><span class="sxs-lookup"><span data-stu-id="25681-122">We embarked on a task to provide—and validate—a proof-of-concept technology stack for the recommendation workload.</span></span> <span data-ttu-id="25681-123">Este documento resumen un enfoque general que se puede usar para proyectos similares.</span><span class="sxs-lookup"><span data-stu-id="25681-123">Here we summarize a general approach that can be used for similar projects.</span></span>  

## <a name="design-goals"></a><span data-ttu-id="25681-124">Diseño de objetivos</span><span class="sxs-lookup"><span data-stu-id="25681-124">Design goals</span></span>

<span data-ttu-id="25681-125">Una prioridad clave era rediseñar y automatizar el flujo de trabajo del modelo para brindar varias ventajas:</span><span class="sxs-lookup"><span data-stu-id="25681-125">A key priority was to redesign and automate the model workflow to provide several advantages:</span></span>

- <span data-ttu-id="25681-126">Ciclos de desarrollo del modelo más rápidos y un tiempo de innovación más rápido.</span><span class="sxs-lookup"><span data-stu-id="25681-126">Faster model development cycles and faster time-to-innovate.</span></span> <span data-ttu-id="25681-127">Cuando los ciclos de preparación de datos y de desarrollo del modelo son eficaces, el volumen de experimentos puede aumentar.</span><span class="sxs-lookup"><span data-stu-id="25681-127">When data preparation and model development cycles are efficient, the volume of experiments can increase.</span></span>  
- <span data-ttu-id="25681-128">Resultados del modelo más precisos y mejores recomendaciones a través de ciclos de reentrenamiento más frecuentes en los datos actualizados.</span><span class="sxs-lookup"><span data-stu-id="25681-128">More accurate model results and better recommendations through more frequent retraining cycles on fresh data.</span></span>
- <span data-ttu-id="25681-129">La implementación de una prueba de concepto (POC) más escalable, que pudiera funcionar en un entorno de producción completo.</span><span class="sxs-lookup"><span data-stu-id="25681-129">A more scalable proof-of-concept (POC) implementation—one that would work in full production.</span></span>
- <span data-ttu-id="25681-130">Tiempos de producción más rápidos mediante la automatización de los procesos entre el desarrollo, las pruebas y la implementación.</span><span class="sxs-lookup"><span data-stu-id="25681-130">Faster time to production by automating the processes between development, test, and deployment.</span></span> <span data-ttu-id="25681-131">La automatización también disminuye los errores operativos y las demoras.</span><span class="sxs-lookup"><span data-stu-id="25681-131">Automation also reduces operational errors and lag times.</span></span>  

## <a name="requirements"></a><span data-ttu-id="25681-132">Requisitos</span><span class="sxs-lookup"><span data-stu-id="25681-132">Requirements</span></span>

<span data-ttu-id="25681-133">El rediseño del flujo de trabajo tenía estos requisitos:</span><span class="sxs-lookup"><span data-stu-id="25681-133">The workflow redesign had the following requirements:</span></span>

- <span data-ttu-id="25681-134">Aprovechar los conocimientos y las aptitudes existentes sobre R del equipo.</span><span class="sxs-lookup"><span data-stu-id="25681-134">Leverage the team’s existing R skills and expertise.</span></span>
- <span data-ttu-id="25681-135">Reutilizar el código cuando tuviera sentido.</span><span class="sxs-lookup"><span data-stu-id="25681-135">Reuse code where it made sense.</span></span>
- <span data-ttu-id="25681-136">Almacenar los datos de suscriptores en una base de datos para integrarla de manera sencilla y rápida en el proceso de entrenamiento y reentrenamiento del modelo.</span><span class="sxs-lookup"><span data-stu-id="25681-136">Store subscriber data in a database to be easily and quickly integrated into the model training and retraining process.</span></span>
- <span data-ttu-id="25681-137">Invocar el reentrenamiento del modelo y la puntuación a través de una interfaz de aplicación web.</span><span class="sxs-lookup"><span data-stu-id="25681-137">Invoke model retraining and scoring through a web app interface.</span></span>
- <span data-ttu-id="25681-138">Usar Azure Active Directory para la autenticación en el front-end web.</span><span class="sxs-lookup"><span data-stu-id="25681-138">Use Azure Active Directory for authentication on the web front end.</span></span>

## <a name="technology-stack"></a><span data-ttu-id="25681-139">Pila de tecnología</span><span class="sxs-lookup"><span data-stu-id="25681-139">Technology stack</span></span>

<span data-ttu-id="25681-140">La canalización de este proyecto requirió varias tecnologías y herramientas y se centró en cuatro áreas:</span><span class="sxs-lookup"><span data-stu-id="25681-140">The pipeline for this project required multiple technologies and tools and centered around four areas:</span></span>

1. <span data-ttu-id="25681-141">Persistencia y accesibilidad de los datos de suscriptores.</span><span class="sxs-lookup"><span data-stu-id="25681-141">Persistence and accessibility of subscriber data.</span></span>
2. <span data-ttu-id="25681-142">Desarrollo, entrenamiento y selección de los modelos.</span><span class="sxs-lookup"><span data-stu-id="25681-142">Development, training, and selection of models.</span></span>  
3. <span data-ttu-id="25681-143">Implementación de modelo y operacionalización.</span><span class="sxs-lookup"><span data-stu-id="25681-143">Model deployment and operationalization.</span></span>
4. <span data-ttu-id="25681-144">Uso de una aplicación web para invocar la puntuación y el reentrenamiento de modelo.</span><span class="sxs-lookup"><span data-stu-id="25681-144">Use of a web application to invoke scoring and model re-training.</span></span>

<span data-ttu-id="25681-145">Los componentes de tecnología del diagrama de la canalización se analizan más detalladamente a continuación.</span><span class="sxs-lookup"><span data-stu-id="25681-145">The technology components in the pipeline diagram are discussed in more detail below.</span></span>

![Arquitectura de optimización](assets/recommendation-engine-optimization/recommendation-architecture.png)

### <a name="microsoft-machine-learning-server"></a><span data-ttu-id="25681-147">Servidor de Microsoft Machine Learning</span><span class="sxs-lookup"><span data-stu-id="25681-147">Microsoft Machine Learning Server</span></span>

<span data-ttu-id="25681-148">El motivo principal para seleccionar cargas de trabajo de R: **[RevoScaleR](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler)** y **Microsoft ML**.</span><span class="sxs-lookup"><span data-stu-id="25681-148">The primary reason for selecting R workloads: **[RevoScaleR](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/revoscaler)** and **Microsoft ML**.</span></span> <span data-ttu-id="25681-149">Las funciones incluidas con estos paquetes se usaban ampliamente en todo el código para importar los datos, crear los modelos de clasificación e implementarlos en producción.</span><span class="sxs-lookup"><span data-stu-id="25681-149">The functions included with these packages were used extensively throughout the code to import the data, create the classification models, and deploy them into production.</span></span>
<span data-ttu-id="25681-150">MLS se implementó en dos máquinas virtuales Linux en Azure: una configurada para "desarrollo" y una para "operaciones".</span><span class="sxs-lookup"><span data-stu-id="25681-150">MLS was deployed on two Linux virtual machines in Azure: one configured for “development” and one configured for “operations.”</span></span> <span data-ttu-id="25681-151">La máquina virtual de desarrollo se aprovisionaba con mucha más memoria y capacidad de procesamiento para facilitar el entrenamiento y la prueba de cientos de modelos.</span><span class="sxs-lookup"><span data-stu-id="25681-151">The development VM was provisioned with significantly more memory and processing power to facilitate the training and testing of hundreds of models.</span></span> <span data-ttu-id="25681-152">También hospedaba RStudio Server para brindar acceso sencillo a un IDE de RStudio para usuarios remotos.</span><span class="sxs-lookup"><span data-stu-id="25681-152">It also hosted RStudio Server to provide easy access to an RStudio IDE for remote users.</span></span> <span data-ttu-id="25681-153">El servidor de operaciones estaba configurado en una máquina virtual más pequeña con las extensiones adicionales necesarias para hospedar modelos de R que se podían llamar desde una aplicación web a través de API REST.</span><span class="sxs-lookup"><span data-stu-id="25681-153">The operations server was configured on a smaller VM with the additional extensions necessary to host R models that were callable from a web application through REST APIs.</span></span>

### <a name="rstudio-server"></a><span data-ttu-id="25681-154">RStudio Server</span><span class="sxs-lookup"><span data-stu-id="25681-154">RStudio Server</span></span>

<span data-ttu-id="25681-155">**[RStudio Server](https://www.rstudio.com/products/rstudio/#Server)** es una aplicación Linux que brinda una interfaz basada en explorador para clientes remotos o portátiles.</span><span class="sxs-lookup"><span data-stu-id="25681-155">**[RStudio Server](https://www.rstudio.com/products/rstudio/#Server)** is a Linux application that provides a browser-based interface for remote or laptop clients.</span></span> <span data-ttu-id="25681-156">Se ejecuta en el puerto 8787 y está disponible para las conexiones remotas una vez que se crea una regla de seguridad de red en la máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="25681-156">It runs on port 8787 and is available to remote connections once a network security rule is created on the Azure VM.</span></span> <span data-ttu-id="25681-157">Para los analistas y los científicos de datos que prefieren el IDE de RStudio, puede ser una opción eficaz para brindar acceso a una máquina virtual con una gran capacidad de memoria y proceso.</span><span class="sxs-lookup"><span data-stu-id="25681-157">For analysts and data scientists who prefer the RStudio IDE, it can be an efficient option for providing access to virtual machine with a large compute and memory capacity.</span></span> <span data-ttu-id="25681-158">Está disponible para descarga tanto en su edición de origen como comercial.</span><span class="sxs-lookup"><span data-stu-id="25681-158">It is available for download in both source and commercial editions.</span></span>

### <a name="azure-sql-database"></a><span data-ttu-id="25681-159">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="25681-159">Azure SQL Database</span></span>

<span data-ttu-id="25681-160">Originalmente, los datos de suscriptor se almacenaban en un archivo .csv muy grande con 6 millones de filas de información sobre compras y preferencias de 500 suscriptores únicos.</span><span class="sxs-lookup"><span data-stu-id="25681-160">Originally, the subscriber data was stored in one very large .csv file with 6 million rows of purchasing and preference information for 500 unique subscribers.</span></span> <span data-ttu-id="25681-161">Almacenar los datos en una base de datos significaba un acceso más rápido a los datos desde R y permitía filtrar las lecturas.</span><span class="sxs-lookup"><span data-stu-id="25681-161">Storing the data in a database meant faster data access from within R and it would allow for filtered reads.</span></span> <span data-ttu-id="25681-162">Ya no sería necesario importar todo el conjunto de datos para entrenamiento o reentrenamiento: los datos se filtrarían por suscriptor en el origen de la base de datos, lo que reduciría considerablemente los recursos necesarios para importar y procesar los datos.</span><span class="sxs-lookup"><span data-stu-id="25681-162">No longer would the entire data set need to be imported for training or retraining: data would be filtered by subscriber at the database source, significantly reducing the resources needed to import and process the data.</span></span>  
<span data-ttu-id="25681-163">Hay varias opciones de bases de datos en la nube administradas en Azure.</span><span class="sxs-lookup"><span data-stu-id="25681-163">There are several managed cloud database options in Azure.</span></span> <span data-ttu-id="25681-164">Se seleccionó [Azure SQL Database](https://docs.microsoft.com/azure/sql-database/) debido a la familiaridad del cliente con SQL Server y, lo que es más importante, a planes a futuros para introducir SQL Server Machine Learning Services en una escala más amplia en Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="25681-164">[Azure SQL Database](https://docs.microsoft.com/azure/sql-database/) was selected because of the customer’s familiarity with SQL Server and—more importantly—future plans to introduce SQL Server Machine Learning Services on a broader scale to Azure SQL Database.</span></span> <span data-ttu-id="25681-165">[SQL Server Machine Learning Services](https://docs.microsoft.com/sql/advanced-analytics/what-is-sql-server-machine-learning?view=sql-server-2017) son las funcionalidades en la base de datos para ejecutar cargas de trabajo de R y Python a través de procedimientos almacenados.</span><span class="sxs-lookup"><span data-stu-id="25681-165">[SQL Server Machine Learning Services](https://docs.microsoft.com/sql/advanced-analytics/what-is-sql-server-machine-learning?view=sql-server-2017) are in-database capabilities for executing R and Python workloads via stored procedures.</span></span>

### <a name="nodejs-and-reactjs"></a><span data-ttu-id="25681-166">Node.js y React.js</span><span class="sxs-lookup"><span data-stu-id="25681-166">Node.js and React.js</span></span>

<span data-ttu-id="25681-167">Se creó una interfaz web para invocar scripts de R y proteger el sitio web.</span><span class="sxs-lookup"><span data-stu-id="25681-167">A web interface was created to invoke R scripts and secure the website.</span></span> <span data-ttu-id="25681-168">Node.js se seleccionó como el marco de servidor web porque habilita un entorno en tiempo de ejecución ligero y eficaz para aplicaciones web dentro de un entorno distribuido.</span><span class="sxs-lookup"><span data-stu-id="25681-168">Node.js was selected as the web server framework because it enables a light-weight and efficient runtime environment for web applications within a distributed environment.</span></span> <span data-ttu-id="25681-169">React se usa para crear interfaces de usuario, se ubica en el front-end y llamada a los servicios web hospedados en el servidor web.</span><span class="sxs-lookup"><span data-stu-id="25681-169">React is used to build user interfaces and sits on the front end and calls web services hosted on the web server.</span></span> <span data-ttu-id="25681-170">Se creía que la combinación de Node y React proporcionaría la ruta más rápida para crear prototipos de servicios web para la canalización del modelo.</span><span class="sxs-lookup"><span data-stu-id="25681-170">It was believed Node + React would provide the quickest path for proto-typing web services for the model pipeline.</span></span>  

## <a name="infrastructure-implementation"></a><span data-ttu-id="25681-171">Implementación de la infraestructura</span><span class="sxs-lookup"><span data-stu-id="25681-171">Infrastructure implementation</span></span>

<span data-ttu-id="25681-172">En las secciones siguientes se describe cómo se implementó la infraestructura de servidor para este proyecto.</span><span class="sxs-lookup"><span data-stu-id="25681-172">The sections below describe how the server infrastructure was deployed for this project.</span></span> <span data-ttu-id="25681-173">Obtener la infraestructura adecuada de desarrollo e implementación puede ser tan fundamental como determinar el enfoque de creación de modelos y las técnicas que se aplicarán.</span><span class="sxs-lookup"><span data-stu-id="25681-173">Getting the right development and deployment infrastructure can be as essential as determining the modeling approach and techniques that will be applied.</span></span>

### <a name="initial-database-load"></a><span data-ttu-id="25681-174">Carga de base de datos inicial</span><span class="sxs-lookup"><span data-stu-id="25681-174">Initial Database Load</span></span>

<span data-ttu-id="25681-175">El primer paso fue importar los datos de suscriptores desde un archivo .csv de gran tamaño a Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="25681-175">The first step was to import the subscriber data from a very large .csv file into Azure SQL Database.</span></span> <span data-ttu-id="25681-176">Existen varias opciones para importar datos a Azure SQL Database descritas en esta [referencia](https://blogs.msdn.microsoft.com/sqlcat/2010/07/30/loading-data-to-sql-azure-the-fast-way/).</span><span class="sxs-lookup"><span data-stu-id="25681-176">There are multiple options for importing data into Azure SQL Database described in in this [reference](https://blogs.msdn.microsoft.com/sqlcat/2010/07/30/loading-data-to-sql-azure-the-fast-way/).</span></span> <span data-ttu-id="25681-177">Le mostramos cómo lo hicimos:</span><span class="sxs-lookup"><span data-stu-id="25681-177">Here is how we did it:</span></span>

1. <span data-ttu-id="25681-178">Creamos la base de datos en Azure Portal con los pasos descritos [aquí](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal).</span><span class="sxs-lookup"><span data-stu-id="25681-178">Created the database through Azure portal following steps [here](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal).</span></span>
2. <span data-ttu-id="25681-179">Descargamos y usamos [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017) para conectar a la base de datos desde la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="25681-179">Downloaded and used [SQL Server Management Studio](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-2017) to connect to the database from the VM.</span></span>
3. <span data-ttu-id="25681-180">Seleccionamos [Asistente para importación y exportación de SQL](https://docs.microsoft.com/sql/integration-services/import-export-data/import-and-export-data-with-the-sql-server-import-and-export-wizard?view=sql-server-2017) (si tiene poco tiempo, hay opciones de importación de datos con más funcionalidades).</span><span class="sxs-lookup"><span data-stu-id="25681-180">Selected the [SQL Import/Export Wizard](https://docs.microsoft.com/sql/integration-services/import-export-data/import-and-export-data-with-the-sql-server-import-and-export-wizard?view=sql-server-2017) (if you are time-constrained, there are more performant data import options).</span></span> <span data-ttu-id="25681-181">Tenga en cuenta que el Asistente para importación y exportación asigna tipos de datos desde el origen de datos al destino y, con nuestro escenario, todos los elementos de datos se asignaron a un tipo de datos varchar(max) que era aceptable.</span><span class="sxs-lookup"><span data-stu-id="25681-181">Keep in mind the import/export wizard maps datatypes from the data source to the target destination; and with our scenario, all data elements were mapped to a varchar(max) data type which was acceptable.</span></span> <span data-ttu-id="25681-182">Si su escenario requiere asignaciones distintas, puede modificar los tipos de datos en el asistente ([referencia](https://docs.microsoft.com/sql/integration-services/import-export-data/data-type-mapping-in-the-sql-server-import-and-export-wizard?view=sql-server-2017)).</span><span class="sxs-lookup"><span data-stu-id="25681-182">If your scenario requires different mappings, you can modify the datatypes in the wizard ([reference](https://docs.microsoft.com/sql/integration-services/import-export-data/data-type-mapping-in-the-sql-server-import-and-export-wizard?view=sql-server-2017)).</span></span>  
4. <span data-ttu-id="25681-183">Debido a que la mayoría de las consultas enviadas a la base de datos se filtrarían según el campo *subscriber_id*, se creó un índice en ese campo.</span><span class="sxs-lookup"><span data-stu-id="25681-183">Since most queries submitted to the database would filter on the field *subscriber_id*, we created an index on that field.</span></span>

### <a name="web-application"></a><span data-ttu-id="25681-184">Aplicación web</span><span class="sxs-lookup"><span data-stu-id="25681-184">Web application</span></span>

<span data-ttu-id="25681-185">La aplicación web es responsable de tres funciones:</span><span class="sxs-lookup"><span data-stu-id="25681-185">The web application is responsible for three functions:</span></span>

- <span data-ttu-id="25681-186">Autenticación: los usuarios web se autentican en *Azure Active Directory* a través del front-end de *React*.</span><span class="sxs-lookup"><span data-stu-id="25681-186">Authentication: web users authenticate against *Azure Active Directory* through the *React* front end.</span></span>
- <span data-ttu-id="25681-187">Puntuación de modelo: acepta datos de entrada desde el usuario para un suscriptor específico, envía los datos del suscriptor al servicio web mediante la API REST, lo que devuelve una respuesta de predicción.</span><span class="sxs-lookup"><span data-stu-id="25681-187">Model scoring: accepts input data from the user for a specific subscriber, submits the subscriber data to the web service using the REST API, which returns a prediction response.</span></span>  
- <span data-ttu-id="25681-188">Reentrenamiento de modelo: acepta un identificador de suscriptor como entrada e invoca un script de R en el servidor de desarrollo para volver a entrenar el modelo para ese suscriptor.</span><span class="sxs-lookup"><span data-stu-id="25681-188">Model re-training: accepts a subscriber identifier as input an,d invokes an R script on the development server to re-train the model for that subscriber.</span></span>

<span data-ttu-id="25681-189">Implementar el inicio de sesión único (SSO) con *Azure Active Directory* resultó ser un desafío más grande de lo esperado.</span><span class="sxs-lookup"><span data-stu-id="25681-189">Implementing single sign-on (SSO) with *Azure Active Directory* turned out to be more of a challenge than expected.</span></span> <span data-ttu-id="25681-190">Esto se debió al marco de aplicación de página única (SPA).</span><span class="sxs-lookup"><span data-stu-id="25681-190">This was due to the single page application (SPA) framework.</span></span> <span data-ttu-id="25681-191">Una biblioteca de Azure Active Directory específica fue clave para el éxito: [react-adal](https://github.com/salvoravida/react-adal).</span><span class="sxs-lookup"><span data-stu-id="25681-191">One specific Azure Active Directory library was key for success: [react-adal](https://github.com/salvoravida/react-adal).</span></span> <span data-ttu-id="25681-192">Las referencias siguientes brindaron una guía útil para implementar la autenticación:</span><span class="sxs-lookup"><span data-stu-id="25681-192">The following references provided helpful guidance for implementing authentication:</span></span>

- [<span data-ttu-id="25681-193">Escenarios de autenticación para Azure AD</span><span class="sxs-lookup"><span data-stu-id="25681-193">Authentication Scenarios for Azure AD</span></span>](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios)
- [<span data-ttu-id="25681-194">Aplicación de página única</span><span class="sxs-lookup"><span data-stu-id="25681-194">Single Page Application</span></span>](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios#single-page-application-spa)

### <a name="development-vm-mls-930"></a><span data-ttu-id="25681-195">Máquina virtual de desarrollo (MLS 9.3.0)</span><span class="sxs-lookup"><span data-stu-id="25681-195">Development VM (MLS 9.3.0)</span></span>

<span data-ttu-id="25681-196">La máquina virtual de desarrollo hospeda el desarrollo, el entrenamiento y el reentrenamiento del modelo, además de la implementación del modelo de clasificación.</span><span class="sxs-lookup"><span data-stu-id="25681-196">The development VM hosted model development, training and re-training, and deployment of the classification model.</span></span> <span data-ttu-id="25681-197">Una máquina virtual de Azure (DS13 V2) se aprovisionó con Linux/Ubuntu 16.10 y se instaló lo siguiente en la máquina virtual base:</span><span class="sxs-lookup"><span data-stu-id="25681-197">An Azure VM (DS13 V2) was provisioned with Linux/Ubuntu 16.10 and the following were installed to the base VM:</span></span>

- <span data-ttu-id="25681-198">Las instrucciones de uso de Machine Learning Server 9.3.0 están disponibles [aquí](https://docs.microsoft.com/machine-learning-server/install/machine-learning-server-install).</span><span class="sxs-lookup"><span data-stu-id="25681-198">Machine Learning Server 9.3.0 using instructions available [here](https://docs.microsoft.com/machine-learning-server/install/machine-learning-server-install).</span></span> <span data-ttu-id="25681-199">Asegúrese de llevar a cabo los pasos de comprobación de la configuración para confirmar la instalación.</span><span class="sxs-lookup"><span data-stu-id="25681-199">Be sure to run through the setup verification steps to confirm the installation.</span></span> <span data-ttu-id="25681-200">Como se trataba de la máquina virtual de desarrollo, se pasó por alto la sección "*Enable web service deployment and remote connections*" (Habilitación de la implementación del servicio web y conexiones remotas).</span><span class="sxs-lookup"><span data-stu-id="25681-200">Because this was the development VM, the section ‘*Enable web service deployment and remote connections*’ was disregarded.</span></span>
- <span data-ttu-id="25681-201">[RStudio Server](https://www.rstudio.com/products/rstudio/download-server/) (versión de código abierto).</span><span class="sxs-lookup"><span data-stu-id="25681-201">[RStudio Server](https://www.rstudio.com/products/rstudio/download-server/) (Open Source Version).</span></span> <span data-ttu-id="25681-202">Tenga cuidado de no volver a instalar R/r-base (se instaló anteriormente con MLS 9.3.0).</span><span class="sxs-lookup"><span data-stu-id="25681-202">Be careful not to re-install R/r-base (it was installed previously with MLS 9.3.0).</span></span>  
- <span data-ttu-id="25681-203">[Agregue un grupo de seguridad de red](https://docs.microsoft.com/azure/virtual-machines/windows/nsg-quickstart-portal) a la máquina virtual para permitir conexiones entrantes a través del puerto 8787 para RStudio Server.</span><span class="sxs-lookup"><span data-stu-id="25681-203">[Add a network security group](https://docs.microsoft.com/azure/virtual-machines/windows/nsg-quickstart-portal) to the VM to allow for inbound connections over port 8787 for RStudio Server.</span></span>  
- <span data-ttu-id="25681-204">Controladores ODBC para controlar la comunicación entre la máquina virtual de desarrollo y Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="25681-204">ODBC drivers to handle the communication between the development VM and Azure SQL Database.</span></span> <span data-ttu-id="25681-205">Los siguientes controladores ODBC estaban instalados en la máquina virtual:</span><span class="sxs-lookup"><span data-stu-id="25681-205">The following odbc drivers were installed on the VM:</span></span>  
- <span data-ttu-id="25681-206">El [controlador ODBC para SQL Server 17](https://www.microsoft.com/download/details.aspx?id=56567) compatible con Linux/Ubuntu 16.10</span><span class="sxs-lookup"><span data-stu-id="25681-206">The [ODBC Driver for SQL Server 17](https://www.microsoft.com/download/details.aspx?id=56567) compatible with Linux/ubuntu 16.10</span></span>  
- <span data-ttu-id="25681-207">Un unixODBC de controlador ODBC de código abierto con las instrucciones de instalación que aparecen en el artículo sobre la [importación de datos relacionales mediante ODBC](https://docs.microsoft.com/machine-learning-server/r/how-to-revoscaler-data-odbc).</span><span class="sxs-lookup"><span data-stu-id="25681-207">An open source ODBC driver unixodbc with installation instructions from [Import relational data using ODBC](https://docs.microsoft.com/machine-learning-server/r/how-to-revoscaler-data-odbc).</span></span> <span data-ttu-id="25681-208">Nota: En este artículo hay dos errores ortográficos en las instrucciones de Ubuntu.</span><span class="sxs-lookup"><span data-stu-id="25681-208">Note: this article has two typos for Ubuntu instructions.</span></span>  
- <span data-ttu-id="25681-209">Para comprobar si uniODBC está instalado:       ````Apt list –installed | grep unixODBC (should be unixodbc)````</span><span class="sxs-lookup"><span data-stu-id="25681-209">To check if unixodbc is installed:       ````Apt list –installed | grep unixODBC (should be unixodbc)````</span></span>
      - <span data-ttu-id="25681-210">Y para instalar el controlador: ````sudo apt-get install unixodbc-devel unixodbc-bin unixodbc (should be unixodbc-dev)````</span><span class="sxs-lookup"><span data-stu-id="25681-210">And to install the driver: ````sudo apt-get install unixodbc-devel unixodbc-bin unixodbc (should be unixodbc-dev)````</span></span>

### <a name="operations-vm-mls-930"></a><span data-ttu-id="25681-211">Máquina virtual de operaciones (MLS 9.3.0)</span><span class="sxs-lookup"><span data-stu-id="25681-211">Operations VM (MLS 9.3.0)</span></span>

<span data-ttu-id="25681-212">La máquina virtual de operaciones hospedaba los puntos de conexión y los servicios web del modelo, almacenaba los archivos de Swagger y las versiones serializadas de los modelos de clasificación.</span><span class="sxs-lookup"><span data-stu-id="25681-212">The operations VM hosted the model web services and endpoints, stored the Swagger files, and stored serialized versions of the classification models.</span></span> <span data-ttu-id="25681-213">La configuración es muy similar al servidor de desarrollo de MLS.</span><span class="sxs-lookup"><span data-stu-id="25681-213">Configuration is very similar to the MLS development server.</span></span> <span data-ttu-id="25681-214">Sin embargo, se configura para la operacionalización, lo que significa que se instalan los servicios web necesarios para atender los puntos de conexión REST.</span><span class="sxs-lookup"><span data-stu-id="25681-214">However, it is configured for operationalization which means the web services necessary to serve the REST endpoints are installed.</span></span> <span data-ttu-id="25681-215">Para implementar la máquina virtual de operaciones, hay plantillas de ARM que hacen que la implementación se realice de manera rápida.</span><span class="sxs-lookup"><span data-stu-id="25681-215">To deploy the operations VM, there are ARM templates that make deployment quick.</span></span> <span data-ttu-id="25681-216">Consulte: [Configuring Microsoft Machine Learning Server 9.3 to Operationalize Analytics using ARM Templates](https://blogs.msdn.microsoft.com/mlserver/2018/02/27/configuring-microsoft-machine-learning-server-9-3-to-operationalize-analytics-using-arm-templates/) (Configuración de Microsoft Machine Learning Server 9.3 para operacionalizar el análisis mediante plantillas de ARM).</span><span class="sxs-lookup"><span data-stu-id="25681-216">See: [Configuring Microsoft Machine Learning Server 9.3 to Operationalize Analytics using ARM Templates](https://blogs.msdn.microsoft.com/mlserver/2018/02/27/configuring-microsoft-machine-learning-server-9-3-to-operationalize-analytics-using-arm-templates/).</span></span> <span data-ttu-id="25681-217">Para nuestro proyecto, se implementó una configuración *One-Box* mediante esta [plantilla de ARM](https://github.com/Microsoft/microsoft-r/tree/master/mlserver-arm-templates/one-box-configuration/linux).</span><span class="sxs-lookup"><span data-stu-id="25681-217">For our project, a *One-Box* configuration was deployed using this [ARM template](https://github.com/Microsoft/microsoft-r/tree/master/mlserver-arm-templates/one-box-configuration/linux).</span></span>  
<span data-ttu-id="25681-218">Con esto, los componentes de servidor para admitir la canalización del modelo estaban listos para empezar.</span><span class="sxs-lookup"><span data-stu-id="25681-218">With this, the server components to support the model pipeline were up and running.</span></span>

## <a name="model-implementation"></a><span data-ttu-id="25681-219">Implementación del modelo</span><span class="sxs-lookup"><span data-stu-id="25681-219">Model implementation</span></span>

<span data-ttu-id="25681-220">Una decisión clave que influyó en el diseño del modelo final para el proyecto en cuestión fue migrar a un diseño de "varios modelos" en lugar de un modelo monolítico único.</span><span class="sxs-lookup"><span data-stu-id="25681-220">One key decision influenced the final model design for this project and that was to move to a “many model” design rather than a single, monolithic model.</span></span> <span data-ttu-id="25681-221">La diferencia: cada suscriptor tiene su propio modelo de clasificación en lugar de un modelo de clasificación grande que atienda a todos los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="25681-221">The difference: each subscriber has their own classification model rather than one big classification model to serve all subscribers.</span></span> <span data-ttu-id="25681-222">Para este cliente, se prefirió este enfoque porque un modelo más pequeño tenía una superficie de memoria menor y era más sencillo de escalar horizontalmente en el entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="25681-222">For this customer, the approach was preferred because a smaller model had a smaller memory footprint and was easier to scale horizontally in production.</span></span>

### <a name="data-import"></a><span data-ttu-id="25681-223">Importación de datos</span><span class="sxs-lookup"><span data-stu-id="25681-223">Data import</span></span>

<span data-ttu-id="25681-224">Todos los datos necesarios para la implementación del modelo residían en una instancia de *Azure SQL Database*.</span><span class="sxs-lookup"><span data-stu-id="25681-224">All the data needed for model development resided in an *Azure SQL Database*.</span></span> <span data-ttu-id="25681-225">Para el entrenamiento y el reentrenamiento del modelo, la importación de datos se realizó en dos etapas:</span><span class="sxs-lookup"><span data-stu-id="25681-225">For model training and retraining, data import was done in two stages:</span></span>

1. <span data-ttu-id="25681-226">Se envió una consulta a la base de datos para recuperar datos para un *subscriber_id* específico y se devolvió un conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="25681-226">A query was submitted to the database to retrieve data for a specific *subscriber_id* and a result set returned.</span></span> <span data-ttu-id="25681-227">Se tomaron en cuenta dos opciones para el acceso de la consulta a la base de datos:</span><span class="sxs-lookup"><span data-stu-id="25681-227">Two options were considered for query access to the database:</span></span>

- <span data-ttu-id="25681-228">Una función de RevoScaleR denominada [RxSQLServerData](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxsqlserverdata)</span><span class="sxs-lookup"><span data-stu-id="25681-228">A RevoScaleR function called [RxSQLServerData](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxsqlserverdata)</span></span>
- <span data-ttu-id="25681-229">El paquete ODBC de R</span><span class="sxs-lookup"><span data-stu-id="25681-229">The R odbc package</span></span>

<span data-ttu-id="25681-230">Se decidió usar la biblioteca "odbc" de R, lo que permitió el filtrado de datos en el nivel de base de datos.</span><span class="sxs-lookup"><span data-stu-id="25681-230">It was decided to use the R “odbc” library which enabled data filtering at the database level.</span></span> <span data-ttu-id="25681-231">Filtrar la tabla de base de datos solo para ver las filas necesarias para un modelo de suscriptor específico minimizó la cantidad de filas a leer en R y a procesar.</span><span class="sxs-lookup"><span data-stu-id="25681-231">Filtering the database table for only the rows needed for a specific subscriber model minimized the number of rows to be read into R and processed.</span></span> <span data-ttu-id="25681-232">Eso redujo la memoria, el proceso y el tiempo global necesario para entrenar o volver a entrenar cada modelo.</span><span class="sxs-lookup"><span data-stu-id="25681-232">That reduced the memory, compute, and overall time needed to train or retrain each model.</span></span>  

1. <span data-ttu-id="25681-233">El conjunto de resultados se convirtió en una trama de datos de R y algunos de los tipos de datos se convirtieron específicamente de varchars a valores enteros o numéricos, según lo requerido por los algoritmos de clasificación.</span><span class="sxs-lookup"><span data-stu-id="25681-233">The result set was converted into an R data frame and some of the data types were explicitly converted from varchars to integers or numerics as required by the classification algorithms.</span></span> <span data-ttu-id="25681-234">Para esta funcionalidad, se usó la función [rxImport](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rximport) de RevoScaleR.</span><span class="sxs-lookup"><span data-stu-id="25681-234">For this functionality, the RevoScaleR function [rxImport](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rximport) was used.</span></span> <span data-ttu-id="25681-235">La función *rxImport* se incluye con RevoScaleR y MicrosoftML y está diseñada para ser multiproceso.</span><span class="sxs-lookup"><span data-stu-id="25681-235">The *rxImport* function is bundled with RevoScaleR and MicrosoftML and is engineered to be multi-threaded.</span></span> <span data-ttu-id="25681-236">Este es un ejemplo de cómo la usamos:</span><span class="sxs-lookup"><span data-stu-id="25681-236">Here is an example of how we used it:</span></span>

````r

# Populate the data frame and modify column types as needed
input_data <- rxImport(sqlServerDataDS, colClasses = c(  
Approved="integer",
      OnTimeArrivalRate="numeric",
      Amount="numeric",
      IsInformed="numeric",
      <continue with list of columns> )
# View the characteristics of the variables in the data source
rxGetInfo (input_data, getVarInfo = TRUE)
````

## <a name="unbalanced-data"></a><span data-ttu-id="25681-237">Datos no equilibrados</span><span class="sxs-lookup"><span data-stu-id="25681-237">Unbalanced data</span></span>

<span data-ttu-id="25681-238">Como el objetivo del modelo de recomendación era predecir la probabilidad de que un cliente renovara un contrato y clasificar la probabilidad según "sí", "no" o "quizás", se usó un algoritmo de clasificación.</span><span class="sxs-lookup"><span data-stu-id="25681-238">Because the goal of the recommendation model was to forecast the probability a customer would renew a contract and categorize the probability it into a ‘yes’, ‘no’, or ‘maybe’, a classification algorithm was used.</span></span> <span data-ttu-id="25681-239">Un problema que puede afectar seriamente la precisión y el rendimiento de un algoritmo de clasificación es un conjunto de datos no equilibrado.</span><span class="sxs-lookup"><span data-stu-id="25681-239">One problem that can seriously impact the accuracy and performance of a classification algorithm is an unbalanced data set.</span></span>  
<span data-ttu-id="25681-240">Un conjunto de datos no es equilibrado si hay muchos más ejemplos de una "clase" que de otra "clase".</span><span class="sxs-lookup"><span data-stu-id="25681-240">A data set is unbalanced if there are many more samples for one ‘class’ than another ‘class’.</span></span> <span data-ttu-id="25681-241">En este caso, el número de filas disponibles de cada suscriptor no estaba equilibrado: en el extremo superior, un suscriptor tenía más de un millón de filas; en el límite inferior, 330 clientes tenían menos de 100 filas de datos.</span><span class="sxs-lookup"><span data-stu-id="25681-241">In this case, the number of rows available for each subscriber was unbalanced: on the high end, one subscriber had 1 million+ rows; on the low end, 330 customers had less than 100 rows of data.</span></span> <span data-ttu-id="25681-242">En el gráfico siguiente se muestra el desequilibrio entre el número de filas (ejemplos) por suscriptor: ![imbalance-chart](assets/recommendation-engine-optimization/recommendaton_engine_chart.png)</span><span class="sxs-lookup"><span data-stu-id="25681-242">The graph below shows the imbalance with the number of rows (samples) per subscriber: ![imbalance-chart](assets/recommendation-engine-optimization/recommendaton_engine_chart.png)</span></span>

<span data-ttu-id="25681-243">Una técnica para manejar un conjunto de datos no equilibrado es cambiar el conjunto de datos y agregar ejemplos a la clase subrepresentada o quitar ejemplos de la clase sobrerrepresentada.</span><span class="sxs-lookup"><span data-stu-id="25681-243">One technique for treating an unbalanced data set is to change the data set and either over-sample the under-represented class, or under-sample the over-represented class.</span></span> <span data-ttu-id="25681-244">Otra técnicas consiste en generar de manera artificial datos adicionales mediante el uso del conocimiento exacto que el propietario de los datos tiene de los datos y sus atributos.</span><span class="sxs-lookup"><span data-stu-id="25681-244">Another technique is to synthetically generate additional data using the data owner’s exact knowledge of the data and its attributes.</span></span> <span data-ttu-id="25681-245">El cliente estableció un umbral para el tamaño de ejemplo mínimo para un suscriptor.</span><span class="sxs-lookup"><span data-stu-id="25681-245">The customer established a threshold for the minimum sample size for a subscriber.</span></span> <span data-ttu-id="25681-246">En el caso de los suscriptores que estaban por debajo de dicho umbral, era necesario manejar los datos.</span><span class="sxs-lookup"><span data-stu-id="25681-246">For subscribers below that threshold, data would need to be treated.</span></span> <span data-ttu-id="25681-247">En este proyecto, se exploraron ambos enfoques.</span><span class="sxs-lookup"><span data-stu-id="25681-247">For this project both approaches were explored.</span></span>

## <a name="algorithm-selection"></a><span data-ttu-id="25681-248">Selección del algoritmo</span><span class="sxs-lookup"><span data-stu-id="25681-248">Algorithm Selection</span></span>

<span data-ttu-id="25681-249">Se evaluaron tres implementaciones de algoritmo de clasificación distintos: *rxDForest*, *rxFastTrees* y *rxFastForest*.</span><span class="sxs-lookup"><span data-stu-id="25681-249">Three different classification algorithm implementations were evaluated: *rxDForest*, *rxFastTrees*, and *rxFastForest*.</span></span> <span data-ttu-id="25681-250">Los tres algoritmos aprovechan los subprocesos múltiples y el paralelismo.</span><span class="sxs-lookup"><span data-stu-id="25681-250">All three algorithms take advantage of multi-threading and parallelism.</span></span> <span data-ttu-id="25681-251">Microsoft ML usará varias CPU o GPU, si hay disponibles.</span><span class="sxs-lookup"><span data-stu-id="25681-251">And Microsoft ML will use multiple CPUs or GPUs if available.</span></span> <span data-ttu-id="25681-252">Los criterios para evaluar los modelos incluidos:</span><span class="sxs-lookup"><span data-stu-id="25681-252">The criteria for evaluating the models included:</span></span>

- <span data-ttu-id="25681-253">¿Los modelos nuevos eran más precisos que el modelo original?</span><span class="sxs-lookup"><span data-stu-id="25681-253">Were the new models more accurate that the original model?</span></span>
- <span data-ttu-id="25681-254">¿La superficie de memoria de los modelos se ejecutó en el entorno de producción?</span><span class="sxs-lookup"><span data-stu-id="25681-254">What was the memory footprint of the models running in production?</span></span> <span data-ttu-id="25681-255">¿El entorno operativo podía admitir la ejecución simultánea de muchos modelos con una respuesta de predicción casi en tiempo real, sin poner en peligro la precisión?</span><span class="sxs-lookup"><span data-stu-id="25681-255">Without compromising accuracy, could the operational environment support simultaneous execution of many models with near real-time prediction response?</span></span>
- <span data-ttu-id="25681-256">¿Qué tan bien manejó el algoritmo el conjunto de datos no equilibrado?</span><span class="sxs-lookup"><span data-stu-id="25681-256">How well did the algorithm handle the unbalanced data set?</span></span> <span data-ttu-id="25681-257">¿Sería necesario manejar previamente el desequilibrio mediante la generación de datos artificiales?</span><span class="sxs-lookup"><span data-stu-id="25681-257">Would the imbalance need to be pre-treated by generating synthetic data?</span></span>

<span data-ttu-id="25681-258">En la tabla siguiente se resumen los resultados:</span><span class="sxs-lookup"><span data-stu-id="25681-258">The table below summarizes the findings:</span></span>

| <span data-ttu-id="25681-259">Algoritmo</span><span class="sxs-lookup"><span data-stu-id="25681-259">Algorithm</span></span> | <span data-ttu-id="25681-260">DESCRIPCIÓN</span><span class="sxs-lookup"><span data-stu-id="25681-260">Description</span></span> | <span data-ttu-id="25681-261">Resultados</span><span class="sxs-lookup"><span data-stu-id="25681-261">Findings</span></span> | <span data-ttu-id="25681-262">Notas</span><span class="sxs-lookup"><span data-stu-id="25681-262">Notes</span></span> |
| :--------- | :------------ | :--------- | :--------------- |
| [<span data-ttu-id="25681-263">rxFastTrees</span><span class="sxs-lookup"><span data-stu-id="25681-263">rxFastTrees</span></span>](https://docs.microsoft.com/machine-learning-server/r-reference/microsoftml/rxfasttrees) | <span data-ttu-id="25681-264">Implementación en paralelo del árbol de decisión incrementado que implementa versiones multiproceso de FastRank.</span><span class="sxs-lookup"><span data-stu-id="25681-264">Parallel implementation of boosted decision tree that implements multi-threaded version of FastRank.</span></span> | <span data-ttu-id="25681-265">Rendimiento preciso y más rápido.</span><span class="sxs-lookup"><span data-stu-id="25681-265">Accurate, fastest performance.</span></span> | <span data-ttu-id="25681-266">Sin características especiales para los datos no equilibrados.</span><span class="sxs-lookup"><span data-stu-id="25681-266">No special features for unbalanced data.</span></span> <span data-ttu-id="25681-267">Los datos tratados previamente se deben proporcionar como entrada.</span><span class="sxs-lookup"><span data-stu-id="25681-267">Pre-treated data needed to be provided as input</span></span> |
| [<span data-ttu-id="25681-268">rxFastForest</span><span class="sxs-lookup"><span data-stu-id="25681-268">rxFastForest</span></span>](https://docs.microsoft.com/machine-learning-server/r-reference/microsoftml/rxfastforest) | <span data-ttu-id="25681-269">Implementación en paralelo de bosque aleatorio y usa rxFastTrees para crear un sistema aprendiz de conjunto de árboles de decisión.</span><span class="sxs-lookup"><span data-stu-id="25681-269">Parallel implementation of random forest and uses rxFastTrees to build an ensemble learner of decision trees.</span></span> | <span data-ttu-id="25681-270">Mayor precisión que el original con datos tratados previamente.</span><span class="sxs-lookup"><span data-stu-id="25681-270">Better accuracy than original with pre-treated data.</span></span> <span data-ttu-id="25681-271">Menor uso intensivo de memoria, más rápido que rxDForest.</span><span class="sxs-lookup"><span data-stu-id="25681-271">Less memory intensive, faster than rxDForest</span></span> |<span data-ttu-id="25681-272">Sin características especiales para los datos no equilibrados.</span><span class="sxs-lookup"><span data-stu-id="25681-272">No special features for unbalanced data.</span></span> <span data-ttu-id="25681-273">Datos tratados previamente proporcionados como entrada.</span><span class="sxs-lookup"><span data-stu-id="25681-273">Pre-treated data provided as input.</span></span> |
| [<span data-ttu-id="25681-274">rxDForest</span><span class="sxs-lookup"><span data-stu-id="25681-274">rxDForest</span></span>](https://docs.microsoft.com/machine-learning-server/r-reference/revoscaler/rxdforest) | <span data-ttu-id="25681-275">Implementación en paralelo de bosque aleatorio.</span><span class="sxs-lookup"><span data-stu-id="25681-275">Parallel implementation of random forest.</span></span> <span data-ttu-id="25681-276">Se incluye en RevoScaleR.</span><span class="sxs-lookup"><span data-stu-id="25681-276">Included in RevoScaleR.</span></span> <span data-ttu-id="25681-277">Puede tratar con datos no equilibrados (quita datos omitidos, condiciona los datos, controla la estratificación de los ejemplos), todo dentro de la llamada de función.</span><span class="sxs-lookup"><span data-stu-id="25681-277">Can deal with unbalanced data (removes missing data, conditions data, handles stratification of samples) all within the function call.</span></span> | <span data-ttu-id="25681-278">Más rápido que el modelo original.</span><span class="sxs-lookup"><span data-stu-id="25681-278">Faster than original model.</span></span> <span data-ttu-id="25681-279">Mejor o igual precisión que el modelo original.</span><span class="sxs-lookup"><span data-stu-id="25681-279">Same or better accuracy than original model.</span></span> <span data-ttu-id="25681-280">Controla el conjunto de datos no equilibrado mediante una variedad de técnicas para volver a tomar ejemplos y sintetizar.</span><span class="sxs-lookup"><span data-stu-id="25681-280">Handles unbalanced data set using a variety of techniques for re-sampling and synthesizing.</span></span> <span data-ttu-id="25681-281">La superficie de memoria más grande.</span><span class="sxs-lookup"><span data-stu-id="25681-281">Largest memory footprint.</span></span>  | <span data-ttu-id="25681-282">La superficie de memoria más grande porque incluye los datos condicionados dentro de la función.</span><span class="sxs-lookup"><span data-stu-id="25681-282">Largest memory footprint because it includes the conditioned data within the function.</span></span>   <span data-ttu-id="25681-283">El tratamiento de los datos era bueno, pero no tanto como las transformaciones personalizadas proporcionadas por el propietario de los datos.</span><span class="sxs-lookup"><span data-stu-id="25681-283">Treatment of the data was good but not as good as the customized transformations provided by the data owner.</span></span> |

<span data-ttu-id="25681-284">Al final, el cliente seleccionó el algoritmo *rxFastForest* y decidió tratar los datos no equilibrados mediante el uso de la biblioteca [vtreat](https://cran.r-project.org/web/packages/vtreat/index.html) y la incorporación de un paso de procesamiento previo de los datos personalizados para generar de manera artificial datos para los suscriptores subrepresentados.</span><span class="sxs-lookup"><span data-stu-id="25681-284">In the end, the customer selected the *rxFastForest* algorithm and decided to treat the unbalanced data by using the [vtreat](https://cran.r-project.org/web/packages/vtreat/index.html) library and adding a customized data pre-processing step to synthetically generate data for the under-represented subscribers.</span></span>

## <a name="model-deployment--web-services"></a><span data-ttu-id="25681-285">Implementación de modelo y servicios web</span><span class="sxs-lookup"><span data-stu-id="25681-285">Model Deployment & Web Services</span></span>

<span data-ttu-id="25681-286">La publicación de un modelo para implementación en la máquina virtual de operaciones es un proceso sencillo y se encuentra en esta documentación de inicio rápido: [Deploy an R Model as a web service with mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/quickstart-publish-r-web-service) (Implementación de un modelo de R como servicio web con mrsdeploy).</span><span class="sxs-lookup"><span data-stu-id="25681-286">Publishing a model for deployment to the operations VM is straight-forward and documented in this QuickStart documentation [Deploy an R Model as a web service with mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/quickstart-publish-r-web-service).</span></span>
<span data-ttu-id="25681-287">En nuestro escenario, una vez que se crearon los modelos en la máquina virtual de desarrollo, se publicaron en la máquina virtual de operaciones con estos pasos:</span><span class="sxs-lookup"><span data-stu-id="25681-287">In our scenario, once the models were created on the development VM, they were published on the operations VM using these steps:</span></span>

1. <span data-ttu-id="25681-288">Establezca un inicio de sesión remoto desde la máquina virtual de desarrollo a la máquina virtual de operaciones con una de las dos funciones disponibles en el paquete mrsdeploy para la autenticación: remoteLogin() con un nombre de administrador local y una contraseña, o bien remoteLoginAAD() con Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="25681-288">Establish a remote login from the developer VM to the operations VM using one of two functions available in the mrsdeploy package for authentication; remoteLogin() using a local admin name and password, or remoteLoginAAD() using Azure Active Directory.</span></span> <span data-ttu-id="25681-289">Ambas opciones se describen en esta referencia, Log in to Machine Learning Server or R Server with mrsdeploy and open a remote session (Inicio de sesión en Machine Learning Server o R Server con mrsdeploy y apertura de una sesión remota).</span><span class="sxs-lookup"><span data-stu-id="25681-289">Both options are described in this reference Log in to Machine Learning Server or R Server with mrsdeploy and open a remote session.</span></span>  
2. <span data-ttu-id="25681-290">Una vez que se entrena un modelo, publíquelo en la máquina virtual de operaciones con las funciones publishService o updateService en el paquete mrsdeploy.</span><span class="sxs-lookup"><span data-stu-id="25681-290">Once a model is trained, publish it to the operations VM using the publishService or updateService functions in the mrsdeploy package.</span></span> <span data-ttu-id="25681-291">Para este proyecto, usamos varios enfoques de implementación y, dependiendo del enfoque, se publicó un modelo nuevo o se actualizó un modelo existente.</span><span class="sxs-lookup"><span data-stu-id="25681-291">For this project, we used multiple deployment approaches, and—depending on the approach—either a new model was published, or an existing model was updated.</span></span> <span data-ttu-id="25681-292">El código siguiente se implementó para controlar ambos casos:</span><span class="sxs-lookup"><span data-stu-id="25681-292">The following code was implemented to handle both cases:</span></span>

````r
# If the service does not exist, publish it and if it does exist, update it.  
# No service by this name so publish one
 api <- publishService(serviceName, code =sc_predict, model = model,  
      inputs = list(prop_data="data.frame"),  
      outputs = list(answer = "numeric"), v = "v1.0.0" )
 print("=========== Model Created =============")
} else {
# A service by this name already exists, update it  
 api <- updateService(serviceName, model = model,
     inputs = list(prop_data="data.frame"), v = "v1.0.0" )
 print("=========== Model Updated =============")
}
 ````

Al implementarlos, los modelos se serializan y almacenan en el servidor de operaciones y se pueden consumir a través de servicios web en modo *estándar* o *en tiempo real*. Cada vez que se llama a un servicio web con el modo estándar, con cada llamada se carga y descarga R y cualquier biblioteca necesaria. Por el contrario, con el modo *en tiempo real*, R y las bibliotecas se cargan solo una vez y se vuelven a usar para llamadas subsiguientes de servicio web. Dado que la mayor parte de la sobrecarga con una llamada de servicio web es la carga de R y las bibliotecas, el modo en tiempo real ofrece una latencia mucho menor para la puntuación del modelo y los tiempos de respuesta pueden ser menores a los 10 ms. Consulte [aquí](https://docs.microsoft.com/machine-learning-server/operationalize/concept-what-are-web-services) ejemplos de referencia y documentación sobre las opciones estándar y en tiempo real. El modo en tiempo real se presta bien para predicciones únicas, pero también puede pasar una trama de datos de entrada para la puntuación. <span data-ttu-id="25681-299">Eso se describe en esta referencia: [Asynchronous web service consumption via batch processing with mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/how-to-consume-web-service-asynchronously-batch) (Consumo de servicio web asincrónico a través del procesamiento por lotes con mrsdeploy).</span><span class="sxs-lookup"><span data-stu-id="25681-299">That is described in this reference: [Asynchronous web service consumption via batch processing with mrsdeploy](https://docs.microsoft.com/machine-learning-server/operationalize/how-to-consume-web-service-asynchronously-batch).</span></span>

## <a name="conclusion"></a><span data-ttu-id="25681-300">Conclusión</span><span class="sxs-lookup"><span data-stu-id="25681-300">Conclusion</span></span>

<span data-ttu-id="25681-301">Aprovechar el paralelismo de las bibliotecas MicrosoftML y RevoScaleR integrado en Microsoft Machine Learning Server aceleró el rendimiento, la implementación y la puntuación de modelos de clasificación individuales para cientos de suscriptores.</span><span class="sxs-lookup"><span data-stu-id="25681-301">Leveraging the parallelism of the MicrosoftML and RevoScaleR libraries built into Microsoft Machine Learning Server accelerated development, deployment, and scoring of individual classification models for hundreds of subscribers.</span></span> <span data-ttu-id="25681-302">La precisión del modelo mejoró y los tiempos de entrenamiento y reentrenamiento se comprimieron, todo con un mínimo de cambio en la base de código R existente.</span><span class="sxs-lookup"><span data-stu-id="25681-302">Model accuracy improved, and training and re-training times were compressed—all with minimal changes to the existing R code base.</span></span>
<span data-ttu-id="25681-303">Implementar la infraestructura para admitir una canalización de modelo y configurar correctamente los componentes de tecnología de un extremo a otro puede ser complejo.</span><span class="sxs-lookup"><span data-stu-id="25681-303">Implementing the infrastructure to support a model pipeline and getting the technology components configured correctly end-to-end can be complex.</span></span> <span data-ttu-id="25681-304">Estas son algunas referencias para empezar con su propio enfoque:</span><span class="sxs-lookup"><span data-stu-id="25681-304">Here are some references to get your started with your own approach:</span></span>

- <span data-ttu-id="25681-305">[Machine Learning Server Documentation](https://docs.microsoft.com/machine-learning-server/) (Documentación sobre Machine Learning Server)</span><span class="sxs-lookup"><span data-stu-id="25681-305">[Machine Learning Server Documentation](https://docs.microsoft.com/machine-learning-server/)</span></span>
- <span data-ttu-id="25681-306">[R Tutorials for Machine Learning Server](https://docs.microsoft.com/advanced-analytics/tutorials/sql-server-r-tutorials?view=sql-server-2017) (Tutoriales de R para Machine Learning Server)</span><span class="sxs-lookup"><span data-stu-id="25681-306">[R Tutorials for Machine Learning Server](https://docs.microsoft.com/advanced-analytics/tutorials/sql-server-r-tutorials?view=sql-server-2017)</span></span>
- <span data-ttu-id="25681-307">[R Samples for Machine Learning Server](https://docs.microsoft.com/machine-learning-server/r/r-samples) (Ejemplos de R para Machine Learning Server)</span><span class="sxs-lookup"><span data-stu-id="25681-307">[R Samples for Machine Learning Server](https://docs.microsoft.com/machine-learning-server/r/r-samples)</span></span>
- <span data-ttu-id="25681-308">[R Function Library Reference](https://docs.microsoft.com/machine-learning-server/r-reference/introducing-r-server-r-package-reference) (Referencia de la biblioteca de funciones de R)</span><span class="sxs-lookup"><span data-stu-id="25681-308">[R Function Library Reference](https://docs.microsoft.com/machine-learning-server/r-reference/introducing-r-server-r-package-reference)</span></span>

## <a name="references"></a><span data-ttu-id="25681-309">Referencias</span><span class="sxs-lookup"><span data-stu-id="25681-309">References</span></span>

<span data-ttu-id="25681-310">Si está interesado en compilar otras soluciones predictivas para su negocio minorista, visite la [sección sobre comercio minorista](https://gallery.azure.ai/industries/retail) de Azure [AI Gallery](https://gallery.azure.ai/).</span><span class="sxs-lookup"><span data-stu-id="25681-310">If you are interested in building other predictive solutions for your retail business, visit the [retail section](https://gallery.azure.ai/industries/retail) of the Azure [AI Gallery](https://gallery.azure.ai/).</span></span>  